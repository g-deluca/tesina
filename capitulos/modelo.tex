\chapter{El modelo de seguirdad de Android}
\label{chapter:background}

\section{Arquitectura de la plataforma}
\label{section:architecture}

El sistema operativo Android está compuesto por cinco capas de software, ordenadas en forma de pila (o
\textit{stack}), donde cada una de ellas provee un grupo de servicios a la capa inmediatamente
superior. De esta forma, se va abstrayendo progresivamente la interacción con el hardware (la base de
la pila) hasta llegar al nivel más alto en el que se ubican las aplicaciones que realizaran las tareas
requeridas por los usuarios. A continuación, analizaremos brevemente cada uno de estos niveles:

\subsubsection*{Núcleo del sistema operativo: Linux}
\label{section:architecture:kernel}
La base de la plataforma Android es el \textit{kernel} de Linux. Desde el punto de vista de la
seguridad, utilizar a un núcleo tan estudiado a lo largo de los años como pilar de la arquitectura,
ayuda a generar confianza en la misma. Además, le permite a los fabricantes de dispositivos
desarrollar controladores de hardware para un kernel ya conocido.

Una de las principales utilidades de Linux de la que Android toma ventaja es del sistema de permisos
basado en usuarios\footnote{El mismo no debe confundirse con el sistema de permisos implementado por
    Android en una de las capas superiores, que es el que se formaliza y estudia en esta tesina}. Esta
característica permite que cada aplicación sea ejecutada dentro de su propia máquina virtual con un
identificador de usuario único (\texttt{UUID}) asignado a la misma. Luego, por defecto, estos
identificadores se inicializan con permisos de lectura y escritura restringidos, de manera tal que los
recursos de cada aplicación queden debidamente aislados y protegidos de potenciales \textit{malwares}.
Sin embargo, este tipo de defensa, implica la existencia de un mecanismo de validación de referencia
que arbitre las situaciones en las que una aplicación deliberadamente desee compartir recursos con
otra. Este mecanismo es implementado en las capas superiores de la arquitectura.

Otras características de Linux utilizadas por Android son: la generación de subprocesos, la
administración de memora de bajo nivel y otras funcionalidades encapsuladas dentro de SELinux
(\textit{\textbf{S}ecurity \textbf{E}nhanced Linux}) como políticas de control de acceso obligatorio
(más conocidas como \textit{MAC} por sus siglas en inglés) para distinguir entre aplicaciones del
sistema y de terceros.

\subsubsection*{Capa de abstracción de hardware}
Esta capa contiene módulos de software encargados de abstraer los diferentes componentes de hardware,
como la antena de \textit{Bluetooth} o la cámara. Estas abstracciones deben ser independientes de los
\textit{drivers} que se encuentran en el núcleo del sistema, briando flexibilidad y transparencia.
Cada módulo está autocontenido en una librería, que es cargada dinámicamente cuando alguna capa
superior lo solicita.

\subsubsection*{Entorno de \textit{runtime} y bibliotecas nativas}
En esta capa encontramos el entorno de \textit{runtime} (o ART~\cite{art}, por sus siglas en inglés)
utilizado por todas las aplicaciones del sistema junto con algunas librerías nativas que la plataforma
le ofrece a los desarrolladores.

\subsubsection*{Marco de trabajo/API de la plataforma}
En esta capa se encuentran las interfaces que la plataforma le brinda a los desarrolladores de
aplicaciones para poder acceder a todas las funciones del sistema operativo. Es en esta capa donde
encontramos los servicios que implementan el mecanismo de validación de referencia mencionado
\hyperref[section:architecture:kernel]{previamente}.

\subsubsection*{Aplicaciones del sistema y de terceros}
Las aplicaciones representan el escalón final en esta pila de abstracciones, siendo los puntos de
entrada para que cualquier usuario de Android interactúe con las funciones del dispositivo. Algunas de
estas aplicaciones ya vienen preinstaladas en la plataforma (como la de mensajería SMS o la encargada
de brindar la interfaz de configuración del sistema) mientras que otras pueden ser instaladas a través
de la tienda oficial o manualmente.


\section{Conceptos preliminares}
\label{section:preliminary}
El mecanismo que arbitra el acceso a los recursos de las aplicaciones está fuertemente basado en las
interacciones entre las mismas. Por eso, en esta sección, introduciremos algunos conceptos que serán
necesarios para un mejor entendimiento del sistema en cuestión.

\subsection{Componentes de una aplicación}
Las aplicaciones de Android están conformadas por distintas piezas, que a pesar de ser funcionales por
sí mismas, interactúan entre ellas para otorgar al usuario la funcionalidad esperada. Por ejemplo, en
una aplicación que reproduce música, existirá un componente que se encargará de presentar la interfaz
al usuario mientras que otro, independiente de la interfaz, será el encargado de reproducir la pista
seleccionada. De esta manera, es posible la reproducción de una canción en segundo~plano\footnote{Una
    aplicación se considera en segundo plano cuando se está ejecutando a pesar de no ser la aplicación que
    actualmente se está mostrando en la pantalla.}.

Existen cuatro tipos de componentes. Cada uno de ellos representa un punto de entrada por el cual el
sistema o el usuario pueden comunicarse con la aplicación y tiene un ciclo de vida distinto. A
continuación, describiremos brevemente cada uno de ellos.

\paragraph{Actividades:}
Una \textit{actividad} es el punto de entrada de interacción con el usuario, el encargado de ubicar
los elementos en la pantalla. Una aplicación puede tener muchas actividades, cada una de ellas
representando una pantalla distinta. Continuando con el ejemplo de la aplicación para reproducir
música, podríamos pensar que la pantalla del reproductor y la del buscador de canciones son dos
actividades distintas.

\paragraph{Servicios:}
Un \textit{servicio} permite ejecutar procesos en segundo plano. En general, es el encargado de la
ejecución de procesos largos, que de ser interrumpidos podrían afectar el desempeño de la aplicación.
Los servicios son puntos de entrada generales a la aplicación, pueden ser iniciados tanto por un
usuario (a través de una actividad), por otro servicio o por el sistema operativo.

\paragraph{Receptores de mensajes (o \textit{intents}): }
Un \textit{receptor de intents} es el componente que se encarga de recibir mensajes del sistema y de
otras aplicaciones, incluso cuando la misma no está en ejecución. Por ejemplo, esta es la forma en la
que el sistema le avisa a todas las aplicaciones que la carga de la batería es baja. Cada aplicación
establece cuáles son los mensajes de su interés, el resto de los mensajes que reciba simplemente serán
ignorados.

\paragraph{Proveedores de contenido:}
El \textit{proveedor de contenido} es el componente encargado de administrar los datos de la
aplicación que se encuentran almacenados en medios persistentes. A través de él, cualquier aplicación
autorizada, puede leer o modificar dichos datos. En otras palabras, un proveedor de contenido actúa
como intermediario entre los datos persistidos y las aplicaciones: no solo la dueña de los datos sino
también todas aquellas que hayan sido previamente autorizadas. Cada recurso allí presente se
identifica con un identificador uniforme de recursos (URI).

\subsection{Interacción entre componentes}
Una característica particular de Android es que cualquier aplicación puede iniciar un componente de
otra. Por ejemplo, una aplicación que desee tomar una foto con la cámara del dispositivo, puede
hacerlo \textit{activando} el componente correspondiente de la aplicación provista por el sistema, en
lugar de implementar una nueva actividad que lo haga. Sin embargo, como los procesos de las
aplicaciones ejecutan en procesos aislados y con permisos que limitan el acceso de otras aplicaciones,
el sistema debe actuar como intermediario en la activación de un componente. Para eso, la aplicación
en cuestión debe enviar un \textit{intent} que especifique que lo que desea es iniciar una actividad
en particular. Luego, el sistema activará ese componente en su lugar.

\subsubsection*{Intents}
Los \textit{intents} son mensajes asíncronos que permiten la comunicación entre componentes y
aplicaciones. Existen tres casos de uso principales: el inicio de una actividad, el inicio de un
servicio y la emisión de un evento, como una indicación de que la batería del dispositivo tiene baja
carga o comenzó a cargarse. Estos mensajes puede ser \textit{explícitos}, en donde el componente de
destino está especificado; o \textit{implícitos}, donde no existe un destinatario específico, pero el
mensaje conlleva la información suficiente para que el sistema encuentre algún componente apropiado.

\subsubsection*{Filtros de intents}
\label{section:preliminary:intent-filter}
Cuando un intent es implícito, Android busca en los \textit{filtros de intents} de cada aplicación
para verificar cuales de ellas son aptas recibir ese mensaje. Si un único filtro de intent es
compatible, la aplicación correspondiente será iniciada. Si existe más de uno, el usuario tendrá la
posibilidad de elegir qué aplicación se activará. Los filtros de intent se declaran en el
\textit{manifiesto} de la aplicación y por lo tanto, son estáticos.

\subsection{Manifiesto de la aplicación}
El archivo de manifiesto de una aplicación es un documento \texttt{xml} que contiene información
estática sobre la misma. Su tarea principal es declarar cuáles son los componentes que corresponden a
la aplicación, para que de esta forma, el sistema pueda reconocerlos como tales. Algunas otras
declaraciones que se encuentran en el manifiesto son:
\begin{enumerate}
    \item El nombre del paquete de la aplicación.
    \item Los filtros de intents \hyperref[section:preliminary:intent-filter]{previamente mencionados}.
    \item Los aspectos de hardware y software que la aplicación utilizará, como una cámara o los
          servicios de Bluetooth.
    \item Los permisos de usuario que requiere la aplicación
\end{enumerate}

\section{Mecanismo básico de protección: permisos}
Como ya mencionamos en la sección \ref{section:architecture:kernel}, existe en Android un mecanismo
encargado de arbitrar el acceso a la información sensible de las aplicaciones y a algunos recursos del
sistema. Este mecanismo, al que a lo largo de este trabajo llamaremos \textit{sistema de permisos},
cumple un rol fundamental en el modelo de seguridad de Android. Este sistema fue el que se ha estudiado
en profunidad y formalizado en esta tesina.

A grandes rasgos, para que una aplicación pueda acceder a un recurso sensible, tanto del sistema como de
otra aplicación, debe haber obtenido previamente los permisos necesarios. De ser así, la operación es
realizada con éxito. Caso contrario, la aplicación debe pedirle al sistema operativo que le otorgue el o
los permisos en cuestión. Finalmente, el sistema operativo, dependiendo del \textit{nivel de protección}
de dicho permiso, puede delegar la decisión al usuario a través un de una ventana emergente.
Análogamente, si un desarrollador desea proteger un recurso de su aplicación, puede definir un permiso y
establecer que el recurso solo puede ser compartido con aquellas otras aplicaciones que cuenten con dicho
permiso. De esta forma, nos encontramos con una primer clasificación entre permisos: aquellos definidos
por las aplicaciones para mantener sus datos protegidos; y los definidos por el sistema, que se necesitan
para ganar acceso a los recursos del dispositivo que pueden comprometer la privacidad del usuario (como
la cámara o la lista de contactos).

Cada permiso tiene un nombre único y cuenta un nivel de protección. El nivel de protección determina de
qué forma procederá el sistema operativo cuando un permiso es solicitado. Existen tres niveles:

\begin{enumerate}
    \item \textbf{Normal:} Estos permisos pueden ser otorgados automáticamente por el sistema ya que se
          utilizan para información o recursos que tienen un riesgo muy bajo de comprometer la seguridad.
    \item \textbf{Peligrosos:} Los permisos de este nivel protegen recursos mucho más sensibles y
          requieren la aprobación explícita del usuario.
    \item \textbf{De misma firma:} Un permiso de este tipo se otorga solamente si la aplicación que lo
          está solicitando y la aplicación que lo declara están firmadas con el mismo certificado.
\end{enumerate}

A partir de la versión \texttt{6} de Android, todos los permisos peligrosos se otorgan en tiempo de
ejecución mientras que los correspondientes a los otros niveles se conceden en el momento en el que la
aplicación se instala.

Los permisos que están asociados a una misma característica de la aplicación o el dispositivo, suelen
estar agrupados. Por ejemplo, tanto el permiso necesario para leer los mensajes de texto, como el que
autoriza la recepción de los mismos, pertenecen a un mismo \textit{grupo de permisos} llamado
\texttt{SMS}. El principal objetivo de agrupar permisos es evitar abrumar al usuario con preguntas sobre
la concesión de los mismos. De esta forma, si una aplicación requiere un permiso peligroso que está
agrupado, el sistema le pedirá que autorice a todo el grupo. En la sección
\ref{subsection:recent-changes:grouped-permissions}, estudiaremos más en detalle qué significa autorizar
a un grupo, dependiendo de la versión de Android.

\subsection*{Delegación de permisos}
Existen dos mecanismos mediante los cuales una aplicación puede delegar sus propios permisos a otra. El
primero consiste en dejar un \texttt{Intent} pendiente, para que otra aplicación pueda tomarlo y
ejecutarlo con los permisos y la identidad de quien lo creó. El segundo método, en cambio, consiste en
que una aplicación que cuenta con permisos de escritura/lectura sobre un proveedor de contenido puede
delegar \textit{temporalmente} esos permisos a otra aplicación. Los permisos delegados serán revocados
una vez que la actividad o servicio que los recibió haya terminado su ejecución.

\section{Cambios recientes - análisis informal}
\label{section:recent-changes}
\subsection{Permisos agrupados}
\label{subsection:recent-changes:grouped-permissions}